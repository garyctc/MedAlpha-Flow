# Component Previews in prev-cli (MedAlpha-Flow)

## Goal
Provide a zero-maintenance, always-up-to-date preview gallery of all design-system UI components (`client/src/components/ui/**`) inside the prev-cli docs site. Previews must render the real components (no code duplication) and match the app's look and feel.

## Scope
- Include all components under `client/src/components/ui/**`.
- Exclude other app components (pages, layouts) by default.
- Show a `/components` index page with a gallery and per-component detail pages.
- Use the real app styling and providers for previews.

## Non-Goals
- Writing detailed component docs content for each page (beyond autogenerated templates).
- Previewing full app pages or flows.
- Building a production CI pipeline for publishing docs.

## Architecture Overview
We will generate preview entries that import and render the real components from the app source. The docs site is still served by `prev-cli`, but previews run with the app's CSS and providers.

Key pieces:
1) **Generator script** scans `client/src/components/ui/**/*.tsx` and writes:
   - `previews/components/<name>/index.tsx` entry files.
   - `docs/components/<name>.mdx` docs pages.
   - `docs/components/index.mdx` gallery page.

2) **Shared preview wrapper** `previews/components/_shared/PreviewProviders.tsx` applies:
   - App base styles (`client/src/styles/index.css`).
   - i18n initialization (`client/src/i18n`).
   - React Query provider (`QueryClientProvider`).
   - Optional lightweight router wrapper if needed for some components.

3) **Alias alignment**: update local `prev-cli` Vite config to read the repo `tsconfig.json` and map `@/*` to `client/src/*`. This allows previews to import app components and utilities exactly as in production code.

## Data Flow
1) Generator scans components and creates preview entries.
2) Each preview entry imports its component and renders it inside `<PreviewProviders>`.
3) `prev-cli` scans `previews/components/**` and surfaces them in `/components` via `PreviewList` and per-component preview routes.
4) Previews are rendered in the WASM runtime during dev for instant iteration.

## Preview Entry Template
Each generated `index.tsx` uses the shared wrapper and optionally passes sample props:

- If the component name exists in a `preview-props` map, those props are used.
- Otherwise it renders with no props.
- Errors are caught in the wrapper and shown as a friendly message.

## Props Strategy
Create `previews/components/_shared/preview-props.ts`:
- Export a dictionary of component name -> props.
- Start empty; add entries as needed for components that require props.

## Error Handling
- Wrap preview rendering in an error boundary.
- If rendering throws, show a simple inline error panel with the component name and hint to add sample props.
- Log the error to console for developer debugging.

## Configuration
Add a small opt-out list file (e.g. `previews/components/_config.json`) so specific components can be excluded without code changes.

## Verification
- Run `prev dev -p 9000` from repo root.
- Visit `/components` and confirm all UI components appear.
- Click a few entries and confirm styles match the app.
- Components that need props should show the error panel; add sample props to fix.

## Risks / Mitigations
- **Alias mismatch**: resolved by mirroring `tsconfig.json` paths in `prev-cli` Vite config.
- **Required props**: handled via preview-props map and error boundary.
- **Implicit globals** (e.g., `window`, routing): minimize by using the app's providers in the wrapper.

## Rollout Plan
1) Add generator script and shared wrapper files.
2) Add alias support to local `prev-cli` config.
3) Generate previews and docs pages.
4) Run `prev dev -p 9000`, validate gallery.
